<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Accounting Assistant</title>
</head>
<body>
  <h1>Companies House Filing Analysis</h1>

  <form id="companyForm">
    <label>Company Number:
      <input type="text" name="company" required>
    </label>
    <button type="submit">Fetch Documents</button>
  </form>

  <h2>Documents</h2>
  <ul id="docList"></ul>

  <h2>AI Output</h2>
  <pre id="output">Waiting...</pre>

  <script>
    document.getElementById("companyForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const company = e.target.company.value;

      // Ask Netlify backend for filings
      const res = await fetch(`/.netlify/functions/companiesHouse?company=${company}`);
      const data = await res.json();

      const list = document.getElementById("docList");
      list.innerHTML = "";
      data.items.forEach(doc => {
        const li = document.createElement("li");
        li.textContent = doc.type + " - " + doc.description;

        // Button to analyse filing
        const btn = document.createElement("button");
        btn.textContent = "Analyse";
        btn.onclick = async () => {
          document.getElementById("output").textContent = "Processing...";
          const res2 = await fetch(`/.netlify/functions/processUpload?docId=${doc.links.document_metadata}`);
          const data2 = await res2.json();
          document.getElementById("output").textContent = data2.output;
        };

        li.appendChild(btn);
        list.appendChild(li);
      });
    });
  </script>
</body>
</html>
