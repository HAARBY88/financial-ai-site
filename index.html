<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ask Gemini (via Make)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 2rem auto; padding: 0 1rem; }
    h1 { color: #004080; }
    label { display:block; margin-top: 1rem; }
    textarea, input[type="text"] { width:100%; padding:.6rem; }
    .row { margin-top: 1rem; display:flex; gap:.5rem; flex-wrap:wrap; }
    button { background:#004080; color:#fff; border:none; padding:.6rem 1rem; cursor:pointer; }
    button:disabled { opacity:.6; cursor:not-allowed; }
    .card { background:#fff; border:1px solid #e3e6ea; border-radius:8px; padding:1rem; margin-top:1rem; }
    pre { background:#f6f8fa; padding:1rem; white-space:pre-wrap; border-radius:6px; }
    .error { color:#b00020; }
    .muted { color:#6b7280; }
  </style>
</head>
<body>
  <h1>Ask Google Gemini</h1>

  <div class="card">
    <label for="question">Your question</label>
    <textarea id="question" rows="4" placeholder="e.g., Summarise the key accounting policies for revenue recognition based on the text below..."></textarea>

    <label for="file">Optional: attach a TXT/CSV file (we’ll send its text):</label>
    <input id="file" type="file" accept=".txt,.csv" />

    <div class="row">
      <button id="askBtn">Ask</button>
      <span id="status" class="muted"></span>
    </div>
  </div>

  <div class="card">
    <h3>Answer</h3>
    <div id="answer" class="muted">No answer yet.</div>
  </div>

  <div class="card">
    <h3>Diagnostics</h3>
    <div id="diag" class="muted">Nothing sent yet.</div>
  </div>

  <script>
    const WEBHOOK_URL = "https://hook.eu2.make.com/o4kmaji8q6m4qpfenqr4u2oiam6fu5de"; // <- paste your Make custom webhook URL here

    const $ = (id) => document.getElementById(id);
    const askBtn = $("askBtn");
    const statusEl = $("status");
    const answerEl = $("answer");
    const diagEl = $("diag");

    askBtn.addEventListener("click", async () => {
      const text = $("question").value.trim();
      const fileInput = $("file");
      const file = fileInput.files[0];

      answerEl.textContent = "";
      statusEl.textContent = "Sending...";
      askBtn.disabled = true;

      let fileText = "";
      if (file) {
        // For now, read TXT/CSV as plain text in the browser
        try {
          fileText = await file.text();
        } catch (e) {
          statusEl.textContent = "";
          answerEl.innerHTML = `<span class="error">Could not read file: ${e.message}</span>`;
          askBtn.disabled = false;
          return;
        }
      }

      // Build payload for Make webhook
      const payload = { text, file_text: fileText };

      // Show what we're sending (for debugging)
      diagEl.textContent = "Sending JSON to Make:\n" + JSON.stringify({
        text: text.slice(0,2000),
        file_text_preview: fileText ? fileText.slice(0,1000) + (fileText.length>1000?'…':'') : "(none)"
      }, null, 2);

      try {
        const res = await fetch(WEBHOOK_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        // Make’s Custom Webhook Response will return JSON
        const data = await res.json().catch(() => ({}));

        if (!res.ok || !data.ok) {
          throw new Error(data.error || `HTTP ${res.status}`);
        }

        answerEl.innerHTML = `<pre>${data.answer || "(no text returned)"}</pre>`;
        statusEl.textContent = "Done.";
      } catch (err) {
        statusEl.textContent = "";
        answerEl.innerHTML = `<span class="error">Request failed: ${err.message}</span>`;
      } finally {
        askBtn.disabled = false;
      }
    });
  </script>
</body>
</html>










